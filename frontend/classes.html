<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Class Booking | Campus Resource Optimizer</title>
  <link rel="stylesheet" href="../frontend/classes.css">
</head>
<body>

  <!-- PAGE HEADER -->
  <header class="page-header">
    <h1>Class schedules</h1>
    <p>Select a class and book an available slot</p>
  </header>

  <!-- CLASS CARDS -->
  <section class="classes">

    <div class="class-card">
      <h2>G-1</h2>
      <p>Subject:M101</p>
      <p>live: 9:30 AM – 10:30 AM</p>
      <button class="book-btn">Book slot</button>
    </div>

    <div class="class-card">
      <h2>G-2</h2>
      <p>Subject:CS101</p>
      <p>live: 11:30 AM – 12:30 PM</p>
      <button class="book-btn">Book slot</button>
    </div>

    <div class="class-card">
      <h2>G-3</h2>
      <p>Subject:iks</p>
      <p>live: 3:30 PM – 4:30 PM</p>
      <button class="book-btn">Book slot</button>
    </div>


  </section>
  <header class="page-header">
    <h1>Labs schedules</h1>
    <p>Select a lab and book an available slot</p>
  </header>

  <section class="labs">
    <div class="class-card">
      <h2>NB101</h2>
      <p>Subject:Cs</p>
      <p>live: 1:30 pM – 3:30</p>
      <button class="book-btn">Book slot</button>
    </div>

    <div class="class-card">
      <h2>NB401</h2>
      <p>Subject:DBMS</p>
      <p>live: 11:30 AM – 2:30 PM</p>
      <button class="book-btn">Book slot</button>
    </div>
    </div>
  </section>

 <script>
  // Select all "Book slot" buttons
  document.querySelectorAll('.book-btn').forEach(button => {
    button.addEventListener('click', async (e) => {
      // 1. Find the parent card to get class details
      const card = e.target.closest('.class-card');
      const resourceName = card.querySelector('h2').innerText; // e.g., "G-1"
      // Get the time from the paragraph containing "live:"
      const slotTime = card.querySelector('p:nth-of-type(2)').innerText; 

      try {
        // 2. Send the booking request to the server
        const response = await fetch('/api/book', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({
            resourceType: 'Class',
            resourceName: resourceName,
            slotTime: slotTime
          })
        });

        const result = await response.json();

        // 3. Provide feedback to the user
        if (result.success) {
          alert("Success: " + result.message);
          e.target.innerText = "Booked";
          e.target.style.backgroundColor = "#28a745"; // Change to green
          e.target.disabled = true;
        } else {
          alert("Error: " + result.message);
        }
      } catch (err) {
        alert("Server error. Make sure your server.js is running!");
      }
    });
  });
</script>

</body>

<section class="notice-card">
  <h3>Important Notice</h3>
  <p>
    Class timings are from <strong>9:30 AM to 5:30 PM</strong>.<br>
    <strong>Saturday and Sunday</strong> are holidays.
  </p>
</section>

</html